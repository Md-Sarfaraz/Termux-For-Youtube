#!/data/data/com.termux/files/usr/bin/bash

# ================= COLORS =================
red='\e[91m'
yellow='\e[93m'
blue='\e[34m'
green='\e[92m'
cyan='\e[96m'
resetcol='\e[49;39m'

# ================= STYLES =================
b='\e[1m'
u='\e[4m'
resetall='\e[0m'

# ================= VARIABLES =================
URL="$1"
DOWNLOAD_DIR="$HOME/storage/shared/Youtube"
OUTPUT_SINGLE="$DOWNLOAD_DIR/%(title)s.%(ext)s"
OUTPUT_PLAYLIST="$DOWNLOAD_DIR/%(playlist)s/%(playlist_index)s.%(title)s.%(ext)s"

FORMAT=""
OUTPUT=""
MODE="single"

# ================= HEADER =================
echo ""
printf "$blue$b"
echo "      MODIFIED BY :"
printf "$green"
figlet " " R A J
printf "$blue"
echo "    Contact Email :"
printf "$green$b"
echo "  sarfarazraj217@gmail.com"
printf "$yellow"
echo "_____________________________________"
echo ""

printf "$cyan$b"
echo "  1) Audio only"
echo "  2) Whole Playlist"
echo "  3) 240p Video"
echo "  4) 360p Video"
echo "  5) 480p Video"
echo "  6) 720p Video"
echo "  7) 1080p Video"
echo "  8) 2K (1440p) Video"
echo "  9) 4K (2160p) Video"
echo -e "  0) More Option ($red BETA $cyan)"
echo ""

printf "$yellow"
echo "——————————————————————————————————————"
printf "$red"
echo " Press between 1 to 9 or Enter"
printf "$yellow"
echo "——————————————————————————————————————"
printf "$resetall"

# ================= INPUT =================
read -r option
echo -e "$cyan Download Started $yellow"

# ================= MENU LOGIC =================
case $option in
  1)
    FORMAT="bestaudio"
    OUTPUT="$OUTPUT_SINGLE"
    AUDIO_OPTS="-x --audio-format mp3 --audio-quality 0"
    ;;
  2)
    FORMAT="bestvideo+bestaudio/best"
    OUTPUT="$OUTPUT_PLAYLIST"
    MODE="playlist"
    ;;
  3)
    FORMAT="bestvideo[height<=240]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  4)
    FORMAT="bestvideo[height<=360]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  5)
    FORMAT="bestvideo[height<=480]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  6)
    FORMAT="bestvideo[height<=720]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  7)
    FORMAT="bestvideo[height<=1080]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  8)
    FORMAT="bestvideo[height<=1440]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  9)
    FORMAT="bestvideo[height<=2160]+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
  0)
    clear
    echo -e "$red$b This part of the project is in BETA version... $resetall"
    exit 0
    ;;
  *)
    FORMAT="bestvideo+bestaudio/best"
    OUTPUT="$OUTPUT_SINGLE"
    ;;
esac

# ================= DOWNLOAD =================
TITLE=$(yt-dlp --no-warnings --get-title "$URL" 2>/dev/null)

yt-dlp \
  --no-warnings \
  --newline \
  --no-mtime \
  -f "$FORMAT" \
  -o "$OUTPUT" \
  $AUDIO_OPTS \
  "$URL"

# ================= NOTIFICATION =================
termux-notification \
  -t "Download Complete" \
  -c "${TITLE:-Download finished}" \
  --sound \
  --vibrate 800 \
  --priority high
